@model Cmx.Timesheet.Website.Models.Timesheet.CalendarDayViewModel

@Scripts.Render("~/bundles/jquery")
@Scripts.Render("~/bundles/jqueryval")


<div class="panel panel-default">
    <div class="panel-heading text-center">
        <span class="panel-title">
            <strong>
                @Html.DisplayFor(model => model.Date, "ShortDateDisplayTemplate")
            </strong>
        </span>
    </div>
    <div class="panel-body form-horizontal">
        @Html.ValidationSummary(true, "", new {@class = "text-danger"})
        @Html.HiddenFor(model => model.Id)
        @Html.HiddenFor(model => model.Date)


        <div class="form-group">
            @Html.LabelFor(model => model.StartTime, htmlAttributes: new {@class = "control-label col-md-2"})
            <div class="col-md-10">
                @Html.EditorFor(model => model.StartTime, new {htmlAttributes = new {@class = "form-control"}})                
                @Html.ValidationMessageFor(model => model.StartTime, "", new {@class = "text-danger"})
            </div>
        </div>
   
        <div class="form-group">
            @Html.LabelFor(model => model.BreakStartTime, htmlAttributes: new {@class = "control-label col-md-2"})
            <div class="col-md-10">
                @Html.EditorFor(model => model.BreakStartTime, new {htmlAttributes = new {@class = "form-control"}})
                @Html.ValidationMessageFor(model => model.BreakStartTime, "", new {@class = "text-danger"})
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.BreakEndTime, htmlAttributes: new {@class = "control-label col-md-2"})
            <div class="col-md-10">
                @Html.EditorFor(model => model.BreakEndTime, new {htmlAttributes = new {@class = "form-control"}})
                @Html.ValidationMessageFor(model => model.BreakEndTime, "", new {@class = "text-danger"})
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.EndTime, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.EndTime, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.EndTime, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(m => m.TotalHours, new { @class = "control-label col-md-2"})
            <div class="col-md-10">
                <span class="form-control disabled" id="totalHoursSpan">
                    @Html.DisplayFor(m => m.TotalHours, "TimeSpanDisplayTemplate")
                </span>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    $().ready(function() {
        $(@Html.IdFor(m => m.StartTime)).bind('change', runCalculate);
        $(@Html.IdFor(m => m.EndTime)).bind('change', runCalculate);
        $(@Html.IdFor(m => m.BreakStartTime)).bind('change', runCalculate);
        $(@Html.IdFor(m => m.BreakEndTime)).bind('change', runCalculate);
    });

    function runCalculate() {
        var inputs = {
            'startTime': $(@Html.IdFor(m => m.StartTime)), 
            'endTime': $(@Html.IdFor(m => m.EndTime)),
            'breakStartTime': $(@Html.IdFor(m => m.BreakStartTime)),
            'breakEndTime': $(@Html.IdFor(m => m.BreakEndTime))
        }

        calculateTotalHrs(inputs);
    }

    //function recalculateTotalHours(index) {
    //    //debugger;
    //    //var dateVal = $('#Calendar_' + index + '__Date').val();
    //    var startTimeVal = $('#Calendar_' + index + '__StartTime').val();
    //    var endTimeVal = $('#Calendar_' + index + '__EndTime').val();
    //    var breakStartTimeVal = $('#Calendar_' + index + '__BreakStartTime').val();
    //    var breakEndTimeVal = $('#Calendar_' + index + '__BreakEndTime').val();
    //    //alert(startTime);

    //    //var startDate = new Date(new Date().toShortDate() + startTimeVal);
    //    debugger;

    //    var startTime = moment(startTimeVal, "HH:mm:ss");
    //    var endTime = moment(endTimeVal, "HH:mm:ss");
    //    var breakStartTime = moment(breakStartTimeVal, "HH:mm:ss");
    //    var breakEndTime = moment(breakEndTimeVal, "HH:mm:ss");

    //    var dayDuration = endTime.subtract(startTime.hours(), 'h');
    //    dayDuration = dayDuration.subtract(startTime.minutes(), 'm');
    //    dayDuration = dayDuration.subtract(startTime.seconds(), 's');

    //    var breakDuration = breakEndTime.subtract(breakStartTime);

    //    var duration = dayDuration.subtract(breakDuration);


    //}
</script>